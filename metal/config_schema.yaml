$schema: "https://json-schema.org/draft/2020-12/schema"
title: "Ubuntu Image Builder Config"
type: object
required:
  - hostname_prefix
  - ip_base
  - hardware
properties:
  hostname_prefix:
    type: string
    pattern: "^[a-zA-Z0-9-]+$"
    description: "Global cluster prefix (e.g. k8s)"
  ip_base:
    type: string
    pattern: "^(?:[0-9]{1,3}\.){3}$"
    description: "IP base (e.g. 192.168.8.)"
  defaults:
    type: object
    properties:
      image_size:
        type: string
        pattern: "^[0-9]+[MG]$"
      timezone:
        type: string
      locale:
        type: string
  hardware:
    type: object
    required: ["models", "devices"]
    properties:
      models:
        type: object
        minProperties: 1
        additionalProperties:
          type: object
          required:
            - architecture
            - base_image
            - gadget
            - kernel
            - hostname_prefix
          properties:
            architecture:
              enum: ["amd64", "arm64", "armhf", "ppc64el", "s390x", "riscv64"]
            base_image:
              type: string
            gadget:
              type: string
            kernel:
              type: string
            hostname_prefix:
              type: string
      devices:
        type: array
        minItems: 1
        items:
          type: object
          required: ["id", "model"]
          properties:
            id:
              type: string
              pattern: "^[0-9]{1,3}$"
              description: "Unique device ID suffix (e.g. 010)"
            model:
              type: string
              description: "Model name matching a key under hardware.models"
